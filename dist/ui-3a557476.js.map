{"version":3,"file":"ui-3a557476.js","sources":["../src/libs/one-euro-filter.js","../src/ui/loading.html?raw","../src/ui/compatibility.html?raw","../src/ui/scanning.html?raw","../src/ui/ui.js"],"sourcesContent":["// Ref: https://jaantollander.com/post/noise-filtering-using-one-euro-filter/#mjx-eqn%3A1\n\nconst smoothingFactor = (te, cutoff) => {\n  const r = 2 * Math.PI * cutoff * te;\n  return r / (r+1);\n}\n\nconst exponentialSmoothing = (a, x, xPrev) => {\n  return a * x + (1 - a) * xPrev;\n}\n\nclass OneEuroFilter {\n  constructor({minCutOff, beta}) {\n    this.minCutOff = minCutOff;\n    this.beta = beta;\n    this.dCutOff = 0.001; // period in milliseconds, so default to 0.001 = 1Hz\n\n    this.xPrev = null;\n    this.dxPrev = null;\n    this.tPrev = null;\n    this.initialized = false;\n  }\n\n  reset() {\n    this.initialized = false;\n  }\n\n  filter(t, x) {\n    if (!this.initialized) {\n      this.initialized = true;\n      this.xPrev = x;\n      this.dxPrev = x.map(() => 0);\n      this.tPrev = t;\n      return x;\n    }\n\n    const {xPrev, tPrev, dxPrev} = this;\n\n    //console.log(\"filter\", x, xPrev, x.map((xx, i) => x[i] - xPrev[i]));\n\n    const te = t - tPrev;\n\n    const ad = smoothingFactor(te, this.dCutOff);\n\n    const dx = [];\n    const dxHat = [];\n    const xHat = [];\n    for (let i = 0; i < x.length; i++) {\n      // The filtered derivative of the signal.\n      dx[i] = (x[i] - xPrev[i]) / te;\n      dxHat[i] = exponentialSmoothing(ad, dx[i], dxPrev[i]);\n\n      // The filtered signal\n      const cutOff = this.minCutOff + this.beta * Math.abs(dxHat[i]);\n      const a = smoothingFactor(te, cutOff);\n      xHat[i] = exponentialSmoothing(a, x[i], xPrev[i]);\n    }\n\n    // update prev\n    this.xPrev = xHat; \n    this.dxPrev = dxHat;\n    this.tPrev = t;\n\n    return xHat;\n  }\n}\n\nexport {\n  OneEuroFilter\n}\n","export default \"<div class=\\\"mindar-ui-overlay mindar-ui-loading\\\">\\n  <div class=\\\"loader\\\"/>\\n</div>\\n\"","export default \"<div class=\\\"mindar-ui-overlay mindar-ui-compatibility\\\">\\n  <div class=\\\"content\\\">\\n    <h1>Failed to launch :(</h1>\\n    <p>\\n      Looks like your device/browser is not compatible.\\n    </p>\\n\\n    <br/>\\n    <br/>\\n    <p>\\n      Please try the following recommended browsers:\\n    </p>\\n    <p>\\n      For Android device - Chrome\\n    </p>\\n    <p>\\n      For iOS device - Safari\\n    </p>\\n  </div>\\n</div>\\n\"","export default \"<div class=\\\"mindar-ui-overlay mindar-ui-scanning\\\">\\n  <div class=\\\"scanning\\\">\\n    <div class=\\\"inner\\\">\\n      <div class=\\\"scanline\\\"/>\\n    </div>\\n  </div>\\n</div>\\n\"","//import \"./ui.scss\";\nimport loadingHTML from './loading.html?raw';\nimport compatibilityHTML from './compatibility.html?raw';\nimport scanningHTML from './scanning.html?raw';\n\nconst css=`.mindar-ui-overlay{display:flex;align-items:center;justify-content:center;position:absolute;left:0;right:0;top:0;bottom:0;background:transparent;z-index:2}.mindar-ui-overlay.hidden{display:none}.mindar-ui-loading .loader{border:16px solid #222;border-top:16px solid white;opacity:.8;border-radius:50%;width:120px;height:120px;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.mindar-ui-compatibility .content{background:black;color:#fff;opacity:.8;text-align:center;margin:20px;padding:20px;min-height:50vh}@media (min-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:50vh;height:50vh}}@media (max-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:80vw;height:80vw}}.mindar-ui-scanning .scanning .inner{position:relative;width:100%;height:100%;opacity:.8;background:linear-gradient(to right,white 10px,transparent 10px) 0 0,linear-gradient(to right,white 10px,transparent 10px) 0 100%,linear-gradient(to left,white 10px,transparent 10px) 100% 0,linear-gradient(to left,white 10px,transparent 10px) 100% 100%,linear-gradient(to bottom,white 10px,transparent 10px) 0 0,linear-gradient(to bottom,white 10px,transparent 10px) 100% 0,linear-gradient(to top,white 10px,transparent 10px) 0 100%,linear-gradient(to top,white 10px,transparent 10px) 100% 100%;background-repeat:no-repeat;background-size:40px 40px}.mindar-ui-scanning .scanning .inner .scanline{position:absolute;width:100%;height:10px;background:white;animation:move 2s linear infinite}@keyframes move{0%,to{top:0%}50%{top:calc(100% - 10px)}}`;\n\nexport class UI {\n  constructor({uiLoading, uiScanning, uiError}) {\n    const cssBlock=document.createElement('style');\n    cssBlock.innerText=css;\n    document.head.appendChild(cssBlock);\n    if (uiLoading === 'yes') {\n      this.loadingModal = this._loadHTML(loadingHTML);\n    } else if (uiLoading !== 'no') {\n      this.loadingModal = document.querySelector(uiLoading);\n    }\n\n    if (uiError === 'yes') {\n      this.compatibilityModal = this._loadHTML(compatibilityHTML);\n    } else if (uiError !== 'no') {\n      this.compatibilityModal = document.querySelector(uiError);\n    }\n\n    if (uiScanning === 'yes') {\n      this.scanningMask = this._loadHTML(scanningHTML);\n    } else if (uiScanning !== 'no') {\n      this.scanningMask = document.querySelector(uiScanning);\n    }\n\n    this.hideLoading();\n    this.hideCompatibility();\n    this.hideScanning();\n  }\n\n  showLoading() {\n    if (!this.loadingModal) return;\n    this.loadingModal.classList.remove(\"hidden\");\n  }\n  hideLoading() {\n    if (!this.loadingModal) return;\n    this.loadingModal.classList.add(\"hidden\");\n  }\n  showCompatibility() {\n    if (!this.compatibilityModal) return;\n    this.compatibilityModal.classList.remove(\"hidden\");\n  }\n  hideCompatibility() {\n    if (!this.compatibilityModal) return;\n    this.compatibilityModal.classList.add(\"hidden\");\n  }\n  showScanning() {\n    if (!this.scanningMask) return;\n    this.scanningMask.classList.remove(\"hidden\");\n  }\n  hideScanning() {\n    if (!this.scanningMask) return;\n    this.scanningMask.classList.add(\"hidden\");\n  }\n\n  _loadHTML(html) {\n    const e = document.createElement('template');\n    e.innerHTML = html.trim();\n    const rootNode = e.content.firstChild;\n    document.getElementsByTagName('body')[0].appendChild(rootNode);\n    return rootNode;\n  }\n}\n\n\n\n"],"names":["smoothingFactor","te","cutoff","r","exponentialSmoothing","a","x","xPrev","OneEuroFilter","minCutOff","beta","t","tPrev","dxPrev","ad","dx","dxHat","xHat","i","cutOff","loadingHTML","compatibilityHTML","scanningHTML","css","UI","uiLoading","uiScanning","uiError","cssBlock","html","e","rootNode"],"mappings":"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"}